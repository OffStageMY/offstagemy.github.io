!function(e){"function"==typeof define&&define.amd?define(["jquery","moment"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("moment")):e(jQuery,moment)}(function(e,t){var a=function(a,n){this.$element=e(a),this.$html='<div class="calendar">',this.$html+="\x3c!-- START CALENDAR HEADER--\x3e",this.$html+='<div class="calendar-header">',this.$html+='<div class="drager">',this.$html+='<div class="years" id="years"></div>',this.$html+="</div>",this.$html+="</div>",this.$html+='<div class="options">',this.$html+='<div class="months-drager drager">',this.$html+='<div class="months" id="months"></div>',this.$html+="</div>",this.$html+='<h4 class="semi-bold date" id="currentDate">&amp;</h4>',this.$html+='<div class="drager week-dragger">',this.$html+='<div class="weeks-wrapper" id="weeks-wrapper">',this.$html+=" </div>",this.$html+="</div>",this.$html+="</div>",this.$html+="\x3c!-- START CALENDAR GRID--\x3e",this.$html+='<div id="calendar" class="calendar-container">',this.$html+="</div>",this.$html+="\x3c!-- END CALENDAR GRID--\x3e",this.$html+="</div>",this.$element.append(this.$html);var r=this;r.settings=e.extend(!0,{},e.fn.pagescalendar.defaults,n);var s=s||{},i=(s={getEventByID:function(e){for(var t=0;t<this.events.length;t++)if(Calendar.settings.events[t]._id==e)return setting.events[t];return null},getEventsByDate:function(e){e=t(e).format("YYYY-MM-DD");for(var a=0;a<this.events.length;a++){var n=t(Calendar.settings.events[a].start).format("YYYY-MM-DD");if(0==e.localeCompare(n))return setting.events[a]}return null},getAllEvents:function(){return this.events},addEvent:function(){this.events.push(event)},lazyFetch:function(){},byDateRange:function(e,a){for(var n=t(e).format("YYYY-MM-DD"),r=t(a).add(24,"hours").format("YYYY-MM-DD"),s=t.range(n,r),i=[],d=0;d<Calendar.settings.disableDates.length;d++){(l=t(Calendar.settings.disableDates[d])).within(s)&&i.push(Calendar.settings.disableDates[d])}var o=[];for(d=0;d<Calendar.settings.events.length;d++){var l;if((l=t(Calendar.settings.events[d].start)).within(s)){for(var c=!1,h=0;h<i.length;h++){var v=t(i[h]).format("YYYY-MM-DD"),u=t.range(v,t(v).add(24,"hours"));if(l.within(u)){c=!0;break}}c||o.push(d)}}return o},hasEventByDate:function(e,a){e=t(e).format(a);for(var n=0;n<Calendar.settings.events.length;n++){var r=t(Calendar.settings.events.start).format(a);if(0==e.localeCompare(r))return!0}return!1},eventCountByDate:function(e,a){e=t(e).format(a);for(var n=0,r=0;r<Calendar.settings.events.length;r++){var s=t(Calendar.settings.events.start).format(a);0==e.localeCompare(s)&&n++}return n},getDisableDateIndexInDateRange:function(e,a,n){e=t(e).format("YYYY-MM-DD"),a=t(a).format("YYYY-MM-DD");for(var r=t.range(e,a),s=[],i=0;i<Calendar.settings.disableDates.length;i++){t(Calendar.settings.disableDates[i]).within(r)&&s.push(t(Calendar.settings.disableDates[i]).format(n))}return s},eventCountByDateRange:function(e,a,n){for(var r=t(e).format("YYYY-MM-DD"),s=t(a).format("YYYY-MM-DD"),i=t.range(r,s),d=[],o=0;o<Calendar.settings.events.length;o++){t(Calendar.settings.events[o].start).within(i)&&d++}return d}},function(){function a(e){this.container=e,this.render()}var n=function(){var t=calendar.year-Calendar.settings.ui.year.startYear;e(".year a").removeClass("active"),e(".year:nth-child("+t+") > a").addClass("active")};return a.prototype.render=function(){e(this.container).html(""),Calendar.content="";var a=Calendar.settings.ui.year.endYear-Calendar.settings.ui.year.startYear;a=a>90?90:a;for(var r=Calendar.settings.ui.year.startYear,s=1;s<=a;s++){r=t(r,Calendar.settings.ui.year.format).add(1,"year").format(Calendar.settings.ui.year.format);var i=calendar.year==r?"active":"";Calendar.content+='<div class="year">',Calendar.content+='<a href="#" class="year-selector '+i+'" data-year='+r+">"+r+"</a>",Calendar.content+="</div>"}e(this.container).append(Calendar.content),Calendar.dragHandler("years"),n(),e(document).off("click","body:not(.pending) .year-selector"),e(document).on("click","body:not(.pending) .year-selector",function(a){var r=e(this).attr("data-year");calendar.year=t(r,Calendar.settings.ui.year.format).year(),n(),Calendar._onYearChange()})},a}()),d=function(e){this.container=e,this.render()};d.prototype={render:function(){e(this.container).html(""),Calendar.content="";for(var a=t.monthsShort(),n=t([calendar.year,calendar.month,calendar.date]).format(Calendar.settings.ui.month.format),r=0;r<a.length;r++){var s=t(a[r],"MMMM").format(Calendar.settings.ui.month.format),i=n==s?"active":"";Calendar.content+='<div class="month">',Calendar.content+='<a href="#" class="month-selector '+i+'" data-month="'+s+'">'+s+"</a>",Calendar.content+="</div>"}e(this.container).append(Calendar.content),Calendar.dragHandler("months"),this._bindEvents()},_setActive:function(){e(".month a").removeClass("active"),e(".month:nth-child("+(parseInt(calendar.month)+1)+") > a").addClass("active")},_bindEvents:function(){var a=this;e(document).off("click","body:not(.pending) .month-selector"),e(document).on("click","body:not(.pending) .month-selector",function(n){var r=e(this).attr("data-month");calendar.month=t(r,Calendar.settings.ui.month.format).month(),Calendar.daysOfMonth=t([calendar.year,calendar.month]).daysInMonth(),Calendar.daysOfMonth<calendar.date&&(calendar.date=Calendar.daysOfMonth),Calendar._onMonthChange(),a._setActive()})}};var o=function(e){this.container=e,this.render(),this._bindEvents()};o.prototype={render:function(){e(this.container).html(""),Calendar.daysOfMonth=t([calendar.year,calendar.month]).daysInMonth(),Calendar.content="";for(var a=parseInt(t(Calendar.settings.ui.week.startOfTheWeek,"d").format("d")),n=parseInt(t(Calendar.settings.ui.week.endOfTheWeek,"d").format("d")),r=1;r<=Calendar.daysOfMonth;r++){var s=t([calendar.year,calendar.month,r]),i=parseInt(t([calendar.year,calendar.month,r]).format("d")),d=calendar.date==r?"active current-date":"";function o(){Calendar.content+='<div class="day-wrapper date-selector">',Calendar.content+='<div class="week-day">',Calendar.content+='<div class="day week-header">'+s.format(Calendar.settings.ui.week.header.format)+"</div>",Calendar.content+="</div>",Calendar.content+='<div class="week-date '+d+'">',Calendar.content+='<div class="day"><a href="#" data-date='+s.format(Calendar.settings.ui.week.day.format)+">"+r+"</a></div>",Calendar.content+="</div>",Calendar.content+="</div>"}(i==a||1==r)&&(Calendar.content+='<div class="week '+d+'">'),a>=n?(i>=a||i==n)&&o():i>=a&&i<=n&&o(),i==n&&(Calendar.content+="</div>")}Calendar.content+="</div>",e(this.container).append(Calendar.content),e(".weeks-wrapper .week .day-wrapper .week-date.active").closest(".week").addClass("active"),Calendar.dragHandler("weeks-wrapper")},_setActive:function(){e(".week").removeClass("active"),e(elem).closest(".week").addClass("active")},_bindEvents:function(){e(document).off("click","body:not(.pending) .date-selector"),e(document).on("click","body:not(.pending) .date-selector",function(t){e(".week-date").removeClass("active"),e(this).children(".week-date").addClass("active"),calendar.date=parseInt(e(this).children(".week-date").children(".day").children("a").attr("data-date")),Calendar._onDayChange()})}};var l=function(e){this.grid=null,this.miniCalendar=null,this.layout=e,this.build()};l.prototype.build=function(){switch(this.layout){case"month":this.grid=new v(".calendar-container");break;case"week":case"day":this.miniCalendar=new o(".weeks-wrapper"),this.grid=new h(".calendar-container",this.layout)}},l.prototype.refresh=function(){return this.grid.refresh()},l.prototype.rebuild=function(){this.build()},l.prototype.reloadEvents=function(){this.grid.reloadEvents()},l.prototype.doubletap=function(e){return this.grid.doubletap(e)},l.prototype.getCurrentDateRange=function(){return this.grid.getCurrentDateRange()},l.prototype.scrollToFirstEvent=function(){return this.grid.scrollToFirstEvent()};var c=function(e){this.container=e},h=function(e,t){this.layout=t,c.call(this,e),this.render(),this.snapGridWidth=null,this.snapGridHeight=null};h.prototype=Object.create(c.prototype),h.prototype.render=function(){this.weekStart=parseInt(t(Calendar.settings.ui.week.startOfTheWeek,"d").format("d")),this.weekEnd=parseInt(t(Calendar.settings.ui.week.endOfTheWeek,"d").format("d")),this.startOfWeek=t([calendar.year,calendar.month,calendar.date]).startOf("week"),this.weekStart>=this.weekEnd?this.endOfWeek=t([calendar.year,calendar.month,calendar.date]).startOf("week").add("days",7+parseInt(Calendar.settings.ui.week.endOfTheWeek)):this.endOfWeek=t([calendar.year,calendar.month,calendar.date]).startOf("week").add("days",parseInt(Calendar.settings.ui.week.endOfTheWeek)),this._buildLayout(),this._timeslots(),this._loadDates(),this._bindEventDraggers(),this._setActive(),this.windowResize(),Calendar.settings.ui.grid.scrollToFirstEvent&&this.scrollToFirstEvent()},h.prototype._buildLayout=function(){var a='<div class="thead" >',n=this.weekEnd;this.weekStart>=this.weekEnd&&(n=7);for(var r=this.weekStart;r<=n;r++)a+='<div class="tcell"></div>';a+="</div>",e(this.container).html(""),Calendar.content="",Calendar.content+='<div class="view '+this.layout+'-view">',Calendar.content+='<div class="allday-cell">',Calendar.content+="</div>",Calendar.content+='<div class="tble" id="viewTableHead">',Calendar.content+=a,Calendar.content+="</div>",Calendar.content+='<div class="grid slot-'+Calendar.settings.slotDuration+'">',Calendar.content+='<div class="time-slot-wrapper" id="time-slots">',Calendar.content+="</div>",Calendar.content+='<div class="tble" id="weekGrid">';for(var s=parseInt(Calendar.settings.slotDuration),i=60/Math.round(s)-1,d=Calendar.settings.minTime;d<Calendar.settings.maxTime;d++){Calendar.content+='<div class="trow" >';for(r=this.weekStart;r<=n;r++){Calendar.content+='<div class="tcell">',Calendar.content+='<div class="cell-inner" data-time-slot="'+d+':00" ></div>';for(var o=0,l=0;l<i;l++)Calendar.content+='<div class="cell-inner" data-time-slot="'+d+":"+(o+=s)+'" ></div>';Calendar.content+="</div>"}Calendar.content+="</div>"}Calendar.content+="</div>",Calendar.content+="</div>",Calendar.content+="</div>",e(this.container).append(Calendar.content),Calendar.cellHeight=e(".tcell").innerHeight(),calendar.startOfWeekDate=t([calendar.year,calendar.month,calendar.date]).startOf("week"),calendar.endOfWeek=t([calendar.year,calendar.month,calendar.date]).endOf("week").format("D"),this.maxMinsPerDay=t(Calendar.settings.maxTime+":00",["H:mm"]).diff(t(Calendar.settings.minTime+":00",["H:mm"]),"minutes"),e(".calendar").removeClass("month").addClass("week")},h.prototype._loadDates=function(){var a=1,n=this.weekEnd;this.weekStart>=this.weekEnd&&(n=7);for(var r=this.weekStart;r<=n;r++){var s=t(this.startOfWeek).add(r,"days");e("#viewTableHead").find(".thead .tcell:nth-child("+a+")").html('<div class="weekdate">'+t(s).format("D")+'</div><div class="weekday">'+t(s).format("dddd")+"</div>").attr("data-day",t(s).format("YYYY-MM-DD")),a++}calendar.startOfWeekDate=t([calendar.year,calendar.month,calendar.date]).startOf("week"),this.showDisableDates(),this._drawEvent()},h.prototype.renderEvent=function(a,n,s,i,d,o,l){var c=Math.round(t(a+":"+n,["H:mm"]).diff(t("0:00",["H:mm"]),"minutes")/Calendar.settings.slotDuration)*Calendar.settings.slotDuration,h=this.maxMinsPerDay-c,v=Math.round(n/Calendar.settings.slotDuration)*Calendar.settings.slotDuration;60==v&&(a=parseInt(a)+1,v=0),v/=Calendar.settings.slotDuration;for(var u,f=e(e(".tble .cell-inner[data-time-slot='"+a+":00']")[d]).parent(),g=t(Calendar.settings.events[o].end).diff(Calendar.settings.events[o].start,"minutes"),m=g=Math.round(g/Calendar.settings.slotDuration)*Calendar.settings.slotDuration;m>0;)m>this.maxMinsPerDay?(u=h/Calendar.settings.slotDuration*this.snapGridHeight,m-=h,m=Math.round(m/Calendar.settings.slotDuration)*Calendar.settings.slotDuration,e(f.children()[v]).append(this._buildEventElement(u,o,d,a,n,s,i)),a=0,n=0,d=parseInt(d)+1,f=e(e(".tble .cell-inner[data-time-slot='"+a+":00']")[d]).parent()):(u=m/Calendar.settings.slotDuration*this.snapGridHeight,m=0,e(f.children()[v]).append(this._buildEventElement(u,o,d,a,n,s,i)));r.settings.onEventRender.call(this)},h.prototype._buildEventElement=function(e,a,n,r,s,i,d){e="height:"+e+"px;";var o="ca_"+t(Calendar.settings.events[a].start).unix()+a,l=1==Calendar.settings.events[a].readOnly?"readonly":"",c="<div class='event-container "+Calendar.settings.events[a].class+" "+l+"' data-event-duration="+t(Calendar.settings.events[a].end).diff(Calendar.settings.events[a].start,"minutes")+" data-index="+a+" data-startTime="+Calendar.settings.events[a].start+" data-endTime="+Calendar.settings.events[a].end+" id="+o+" data-id="+o+" data-row="+parseInt(r)+" data-cell="+n+" style="+e+">";return c+="<div class='event-inner'>",c+="<div class='event-title'>"+Calendar.settings.events[a].title+"</div>",c+="<div class='time-wrap'><span class='event-start-time'>"+t(Calendar.settings.events[a].start).format(Calendar.settings.timeFormat)+"</span> - ",c+="<span class='event-end-time'>"+t(Calendar.settings.events[a].end).format(Calendar.settings.timeFormat)+"</span></div>",c+="</div>",0!=Calendar.settings.events[a].readOnly&&null!=Calendar.settings.events[a].readOnly||(c+="<div class='resizable-handle'></div>"),c+="</div>",Calendar.settings.events[a].dataID=o,c},h.prototype._drawEvent=function(){this.snapGridWidth=parseInt(e(".tcell").outerWidth()),this.snapGridHeight=parseInt(e(".cell-inner").outerHeight());this.weekEnd;this.weekStart,this.weekEnd;var a=s.byDateRange(this.startOfWeek,this.endOfWeek);e("#weekGrid").find(".event-container").remove(),e(".tble > .thead > .tcell").find(".event-bubble").remove();for(var n=0;n<a.length;n++){var r=a[n],i=t(Calendar.settings.events[r].start),d=t(Calendar.settings.events[r].start).format("e");"0"==d&&parseInt(Calendar.settings.ui.week.startOfTheWeek)>0&&(d=7);var o,l,c=parseInt(d)-parseInt(Calendar.settings.ui.week.startOfTheWeek),h=i.format("H"),v=i.format("m");null==Calendar.settings.events[r].end?(o=parseInt(h)+1,l="0"):(o=t(Calendar.settings.events[r].end).format("H"),l=t(Calendar.settings.events[r].end).format("m"));var u=t(o+":"+l,"h:mm").diff(t(h+":"+v,"h:mm"),"minutes",!0);Calendar.settings.ui.grid.eventBubble&&null!=Calendar.settings.events[r].class&&this._setEventBubble(Calendar.settings.events[r].class,c),this.renderEvent(h,v,o,l,c,r,u)}0==Calendar.settings.eventOverlap&&this.collisionGroups(a),this.setEventBubbles(Calendar.settings.events)},h.prototype.collisionGroups=function(a){for(var n=[],r=1;r<a.length;r++){var s=t.range(Calendar.settings.events[a[r]].start,Calendar.settings.events[a[r]].end),i=r-1;do{var d=[];event2Range=t.range(Calendar.settings.events[a[i]].start,Calendar.settings.events[a[i]].end),s.overlaps(event2Range)&&(d.push(a[r]),d.push(a[i]),n.push(d)),i--}while(0===i)}function o(e){for(var t=e.concat(),a=t.length,n=0;n<t.length;++n)for(var r=n+1;r<t.length;++r)t[n]===t[r]&&t.splice(r--,1);return a!=t.length?t:[]}for(r=0;r<n.length;++r)for(i=r+1;i<n.length;++i){var l=o(n[r].concat(n[i]));l.length>0&&(n[i]=l,n.splice(r,1),i--)}for(r=0;r<n.length;r++){var c=100/n[r].length,h=0;for(i=0;i<n[r].length;i++){e(".event-container[data-index='"+n[r][i]+"']").css({width:c+"%",left:h+"%"}),h+=c}}},h.prototype._setEventBubble=function(t,a){var n=e("#viewTableHead").find(".thead .tcell:nth-child("+(parseInt(a)+1)+")");0==n.children("."+t).length&&n.append('<div class="event-bubble '+t+'"></div>')},h.prototype._timeslots=function(){Calendar.content="";for(var a=Calendar.settings.minTime;a<Calendar.settings.maxTime;a++)Calendar.content+='<div class="time-slot"><span>'+t().hour(a).format(Calendar.settings.ui.grid.timeFormat)+"</span></div>";e("#time-slots").append(Calendar.content)},h.prototype._setActive=function(){e("#viewTableHead").find(".thead .tcell").removeClass("active"),e("#weekGrid").find(".trow .tcell").removeClass("active");var a=t([calendar.year,calendar.month,calendar.date]).format("e"),n=0;n=0==a&&parseInt(Calendar.settings.ui.week.startOfTheWeek)>a?7:parseInt(a)+(1-parseInt(Calendar.settings.ui.week.startOfTheWeek)),e("#viewTableHead").find(".thead .tcell:nth-child("+n+")").addClass("active"),e("#weekGrid").find(".trow .tcell:nth-child("+n+")").addClass("active")},h.prototype.scrollToFirstEvent=function(){var t=s.byDateRange(this.startOfWeek,this.endOfWeek);if(0==t.length)return!1;var a=e(".cell-inner [data-index='"+t[0]+"']"),n=e(".calendar .calendar-container .grid"),r=e(".calendar .calendar-container .grid").get(0).getBoundingClientRect(),i=a.get(0).getBoundingClientRect().top-r.top-Calendar.settings.ui.grid.scrollToGap,d=n.scrollTop();n.animate({scrollTop:d+i},Calendar.settings.ui.grid.scrollToAnimationSpeed)},h.prototype.doubletap=function(a){var n=e(a),r=e("#viewTableHead").find(".thead .tcell:nth-child("+(n.parent().index()+1)+")").attr("data-day"),s=t(n.attr("data-time-slot"),["H:mm"]).format(" H:mm");return{date:r=t(r+s,"YYYY/MM/D h:mm").format()}},h.prototype.showDisableDates=function(){e(".tble .trow .tcell").removeClass("disable").children(".cell-inner").removeClass("disable"),this.disableDates=s.getDisableDateIndexInDateRange(this.startOfWeek,this.endOfWeek,"e");for(var t=0;t<this.disableDates.length;t++)e(".tble .trow .tcell:nth-child("+(parseInt(this.disableDates[t])+1)+")").addClass("disable").children(".cell-inner").addClass("disable")},h.prototype.refresh=function(){var e=t([calendar.year,calendar.month,calendar.date]);this.weekStart=parseInt(t(Calendar.settings.ui.week.startOfTheWeek,"d").format("d")),this.weekEnd=parseInt(t(Calendar.settings.ui.week.endOfTheWeek,"d").format("d")),0==this.weekEnd&&(this.weekEnd=7),0==e.weekday()&&this.weekStart>0?this.startOfWeek=t([calendar.year,calendar.month,calendar.date]).subtract("days",this.weekEnd).startOf("week"):this.startOfWeek=t([calendar.year,calendar.month,calendar.date]).startOf("week"),this.endOfWeek=e.startOf("week").add("days",this.weekEnd),this._loadDates(),this._setActive();var a=[this.startOfWeek,this.endOfWeek];return this.setEventBubbles(Calendar.settings.events),a},h.prototype.reloadEvents=function(){this._drawEvent()},h.prototype.rebuild=function(){this.grid._buildLayout(),this.refresh()},h.prototype.windowResize=function(){var t=this;e(window).resize(function(){t.snapGridWidth=parseInt(e(".tcell").outerWidth()),t._bindEventDraggers()})},h.prototype.getCurrentDateRange=function(){return[this.startOfWeek,this.endOfWeek]},h.prototype.setEventBubbles=function(a){for(var n in e(".has-event").removeClass("has-event"),Calendar.settings.events){var r=t(Calendar.settings.events[n].start).format(Calendar.settings.ui.year.format),s=t(Calendar.settings.events[n].start).format(Calendar.settings.ui.month.format),i=t(Calendar.settings.events[n].start).format("D");Calendar.settings.ui.year.eventBubble&&e('.year > [data-year="'+r+'"]').addClass("has-event"),calendar.year==t(Calendar.settings.events[n].start).format("YYYY")&&(Calendar.settings.ui.month.eventBubble&&e('.month > [data-month="'+s+'"]').addClass("has-event"),calendar.month+1==t(Calendar.settings.events[n].start).format("M")&&Calendar.settings.ui.week.eventBubble&&e('.date-selector > .week-date > .day > [data-date="'+i+'"]').addClass("has-event"))}};var v=function(e){this.monthViewStartDate="",this.monthViewEndDate="",c.call(this,e),this.gridElem="",this.render()};return v.prototype=Object.create(c.prototype),v.prototype.render=function(){this.weekStart=parseInt(t(Calendar.settings.ui.week.startOfTheWeek,"d").format("d")),this.weekEnd=parseInt(t(Calendar.settings.ui.week.endOfTheWeek,"d").format("d")),this.startOfWeek=t([calendar.year,calendar.month,calendar.date]).startOf("week"),this.endOfWeek=t([calendar.year,calendar.month,calendar.date]),this._buildLayout(),this._loadDates(),this._bindEvents(),this.bindEventDraggers()},v.prototype._buildLayout=function(){for(var a='<div class="thead" >',n=this.weekStart;n<=this.weekEnd;n++)a+='<div class="tcell"></div>';a+="</div>",e(this.container).html(""),Calendar.content="",Calendar.content+='<div class="view month-view">',Calendar.content+='<div class="tble" id="viewTableHead">',Calendar.content+=a,Calendar.content+="</div>",Calendar.content+='<div class="grid">',Calendar.content+='<div class="tble" id="monthGrid">';for(var r=0;r<6;r++){Calendar.content+='<div class="trow" >';for(n=this.weekStart;n<=this.weekEnd;n++)Calendar.content+='<div class="tcell">',Calendar.content+='<div class="month-date"></div>',Calendar.content+='<div class="cell-inner"><div class="holder"></div></div>',Calendar.content+="</div>";Calendar.content+="</div>"}Calendar.content+="</div>",Calendar.content+="</div>",Calendar.content+="</div>",e(this.container).append(Calendar.content),cellHeight=e(".tcell").innerHeight(),calendar.startOfWeekDate=t([calendar.year,calendar.month,calendar.date]).startOf("week"),calendar.endOfWeek=t([calendar.year,calendar.month,calendar.date]).endOf("week").format("D"),this.snapGridWidth=parseInt(e(".tcell").outerWidth()),this.snapGridHeight=parseInt(e(".cell-inner").outerHeight()),this.holderHeight=parseInt(e(".holder").outerHeight()),e(".calendar").removeClass("week").addClass("month")},v.prototype._loadDates=function(){e(".tcell").removeClass("not active current-date"),e(".month-date").removeClass("not active current-date");for(var a=1,n=this.weekStart;n<=this.weekEnd;n++){var r=t(this.startOfWeek).add(n,"days");e("#viewTableHead").find(".thead .tcell:nth-child("+a+")").html('</div><div class="weekday">'+t(r).format("dddd")+"</div>").attr("data-day",t(r).format("YYYY-MM-DD")),a++}calendar.startOfWeekDate=t([calendar.year,calendar.month,calendar.date]).startOf("week");var s=t([calendar.year,calendar.month,calendar.date]).startOf("month").startOf("week");this.monthViewStartDate=t([calendar.year,calendar.month,calendar.date]).startOf("month").startOf("week");var i=null;this.gridElem=e(this.container).find(".view .grid");for(n=1;n<=6;n++)for(var d=this.weekStart;d<=this.weekEnd;d++){var o=parseInt(s.format("M"))-1;calendar.month!=o&&(i="not"),calendar.date==s.format("D")&&calendar.month==o&&(i="current-date active"),this.gridElem.find(".tble .trow:nth-child("+n+") .tcell:nth-child("+(d+1)+")").addClass(i).attr("data-date",s.format("YYYY-MM-DD")).children(".month-date").html(s.format("D")).addClass(i),s=s.add(1,"days"),i=""}this.monthViewEndDate=s,this._showDisableDates(),this._drawEvent(),this.setEventBubbles()},v.prototype._bindEvents=function(){var a=this;e(".month-view .tcell").off("click"),e(".month-view .tcell").on("click",function(){var n=t(e(this).attr("data-date"));calendar.date=n.format("D"),calendar.month=parseInt(n.format("M"))-1,a.setActive(e(this)),Calendar._buildCurrentDateHeader()})},v.prototype._drawEvent=function(){var a=s.byDateRange(this.monthViewStartDate.format("YYYY-MM-DD"),this.monthViewEndDate.format("YYYY-MM-DD"));e("#monthGrid").find(".event-container").remove(),e("#monthGrid").find(".ghost-element").remove();for(var n=0;n<a.length;n++){var r=a[n],i=e(".tble [data-date='"+t(Calendar.settings.events[r].start).format("YYYY-MM-DD")+"']"),d=t(t(Calendar.settings.events[r].end)).diff(t(Calendar.settings.events[r].start),"days");d=d=0===d?1:d,this.renderEvent(i,r,d)}},v.prototype.renderEvent=function(e,a,n){var s="style='width:"+100*parseInt(n)+"%'",i="ca_"+t(Calendar.settings.events[a].start).unix()+a,d=1==Calendar.settings.events[a].readOnly?"readonly":"",o="<div class='event-container "+Calendar.settings.events[a].class+" "+d+"' "+s+" data-index="+a+" data-startTime="+Calendar.settings.events[a].start+" data-endTime="+Calendar.settings.events[a].end+" id="+i+" data-id="+i+">";o+="<div class='event-inner'>",o+="<div class='event-title'>"+Calendar.settings.events[a].title+"</div>",o+="</div>",o+="</div>",e.children(".cell-inner").children(".holder").append(o),Calendar.settings.events[a].dataID=i,r.settings.onEventRender.call(this)},v.prototype.doubletap=function(a){var n=e(a).parent();return{date:t(n.attr("data-date")).format()}},v.prototype.bindEventDraggers=function(){var a=e("#monthGrid")[0],n=null,s=this;interact(".event-container:not(.readonly)").draggable({inertia:!0,restrict:{restriction:a,elementRect:{top:0,left:0,bottom:1,right:1},endOnly:!0,drag:""},mode:"anchor",anchors:[],autoScroll:!0,onmove:function(e){Calendar.dragMoveListener(e),e.target.classList.add("dragging")},onend:function(e){e.target.classList.remove("dragging")}}).snap({mode:"anchor",anchors:[],range:1/0,elementOrigin:{x:.5,y:.5},endOnly:!0}).on("dragstart",function(e){if(!n){var t=interact.getElementRect(e.target);n={x:t.left+t.width/2,y:t.top+t.height/2}}e.interactable.snap({anchors:[n]})}),interact(".tcell").dropzone({overlap:"center",accept:".event-container"}).on("dragenter",function(t){var a=interact.getElementRect(e(t.target).children(".cell-inner").children(".holder")[0]),n=interact.getElementRect(t.relatedTarget),r={x:a.left+n.width/2,y:a.top+n.height/2};t.draggable.snap({anchors:[r]});t.relatedTarget;t.target.classList.add("drop-target")}).on("dragleave",function(t){t.draggable.snap(!1),t.draggable.snap({anchors:[n]}),t.target.classList.remove("drop-target"),e(t.target).find(".ghost-element").remove()}).on("dropactivate",function(e){}).on("dropdeactivate",function(e){e.target.classList.remove("drop-active"),e.target.classList.remove("drop-target")}).on("drop",function(a){var n=a.target,i=a.relatedTarget;n=e(n);var d=(i=e(i)).data(),o=Calendar.constructEventForUser(d.index);o.readOnly?s._drawEvent():(o.start=t(o.start).set("month",t(n.attr("data-date")).get("month")).format(),o.start=t(o.start).set("date",t(n.attr("data-date")).get("date")).format(),o.end=t(o.start).set("date",t(n.attr("data-date")).get("date")).format(),Calendar.settings.events[d.index]=o,s._drawEvent(),r.settings.onEventDragComplete(o))})},v.prototype._showDisableDates=function(){e(".tble .trow .tcell").removeClass("disable").children(".cell-inner").removeClass("disable"),this.disableDates=s.getDisableDateIndexInDateRange(this.monthViewStartDate.format("YYYY-MM-DD"),this.monthViewEndDate.format("YYYY-MM-DD"),"YYYY-MM-DD");for(var t=0;t<this.disableDates.length;t++)e(".tble .trow .tcell[data-date='"+this.disableDates[t]+"']").addClass("disable").children(".cell-inner").addClass("disable")},v.prototype.setActive=function(t){e(".month-view .tcell").children(".month-date").removeClass("active"),t.children(".month-date").addClass("active")},v.prototype.refresh=function(){return this._loadDates(),this._drawEvent(),[this.monthViewStartDate,this.monthViewEndDate]},v.prototype.reloadEvents=function(){this._drawEvent()},v.prototype.getCurrentDateRange=function(){return[this.monthViewStartDate,this.monthViewEndDate]},v.prototype.setEventBubbles=function(a){for(var n in e(".has-event").removeClass("has-event"),Calendar.settings.events){var r=t(Calendar.settings.events[n].start).format(Calendar.settings.ui.year.format),s=t(Calendar.settings.events[n].start).format(Calendar.settings.ui.month.format),i=t(Calendar.settings.events[n].start).format("D");e('.year > [data-year="'+r+'"]').addClass("has-event"),calendar.year==t(Calendar.settings.events[n].start).format("YYYY")&&(e('.month > [data-month="'+s+'"]').addClass("has-event"),calendar.month+1==t(Calendar.settings.events[n].start).format("M")&&e('.date-selector > .week-date > .day > [data-date="'+i+'"]').addClass("has-event"))}},r.Calendar=r.Calendar||{},r.Calendar={settings:r.settings,yearPicker:null,monthPicker:null,gridLayout:null},Calendar={Init:function(a){this.settings=r.settings,null!=Calendar.settings.ui.year&&null!=Calendar.settings.ui.month&&null!=Calendar.settings.ui.dateHeader&&null!=Calendar.settings.ui.week&&null!=Calendar.settings.ui.grid||alert("You have not included the proper ui[] settings, please refer docs"),this._setLocale(),calendar.monthLong=t().format(this.settings.ui.month.format),null!=this.settings.now?(calendar.month=t(r.settings.now).month(),calendar.year=t(r.settings.now).year(),calendar.date=t(r.settings.now).format("D"),calendar.dayOfWeek=t(r.settings.now).day(),calendar.monthLong=t(r.now).format("MMM")):(calendar.month=t().month(),calendar.year=t().year(),calendar.date=t().format("D"),calendar.dayOfWeek=t().day(),calendar.monthLong=t().format("MMM")),Calendar.settings.ui.year.visible||e(".calendar-header").hide(),Calendar.settings.ui.month.visible||e("#months").hide(),Calendar.settings.ui.dateHeader.visible||e("#currentDate").hide(),Calendar.settings.ui.week.visible||e("#weeks-wrapper").hide(),this.yearPicker=new i("#years"),Calendar.settings.weekends||(Calendar.settings.ui.week.startOfTheWeek=1,Calendar.settings.ui.week.endOfTheWeek=5),this.monthPicker=new d("#months"),this._buildCurrentDateHeader(),this.gridLayout=new l(Calendar.settings.view);var n=this.gridLayout.getCurrentDateRange(),s={start:n[0],end:n[1]};r.settings.onViewRenderComplete(s),!a&&this.bindEventHanders(),this.autoFocusActiveElement(),this.scrollToElement("#weeks-wrapper .active");var o="calc(100% - "+(e(".calendar .options").get(0).getBoundingClientRect().height+e(".calendar-header").get(0).getBoundingClientRect().height)+"px)";e("#calendar").css({height:o})},rebuild:function(){Calendar.Init(!0)},_highlightWeek:function(t){e(".week").removeClass("active"),e(t).closest(".week").addClass("active")},_buildCurrentDateHeader:function(){e("#currentDate").text(t([calendar.year,calendar.month,calendar.date]).format(Calendar.settings.ui.dateHeader.format))},_onYearChange:function(){this._onMonthChange()},_onMonthChange:function(){this._onDayChange()},_onDayChange:function(){this._buildCurrentDateHeader(),null!=this.gridLayout.miniCalendar&&this.gridLayout.miniCalendar.render();var e=this.gridLayout.refresh(),t={start:e[0],end:e[1]};r.settings.onDateChange(t)},_loading:function(){e(".grid .tble").prepend("<div class='loading'><div class='progress progress-small'><div class='progress-bar-indeterminate' style='display: block;'></div></div></div>")},_loaded:function(){e(".grid .tble .loading").remove()},_errorMessage:function(t){e(".grid .tble").prepend("<div class='loading'></div>"),t&&e(".grid .tble .loading").pgNotification({style:"bar",message:t,position:"top",timeout:0,type:"danger",onClosed:function(){e(".grid .tble .loading").remove()}}).show()},dragHandler:function(t){var a=e("#"+t),n=a.parent();if(!e("body").hasClass("mobile")&&1==a.length){e(".drager").scrollbar();n.scrollLeft();interact("#"+t).draggable({preventDefault:"auto",onmove:function(e){var t=e.target,a=(parseFloat(t.getAttribute("data-x"))||0)+e.dx;inverseX=-a,n.scrollLeft(inverseX),t.setAttribute("data-x",a)}})}},autoFocusActiveElement:function(){var t;e(window).resize(function(){clearTimeout(t),t=setTimeout(function(){Calendar.scrollToElement("#weeks-wrapper .active")},500)})},scrollToElement:function(t){if(0==!(t=e(t)).length){var a=e(t).parent();if(!this._isElementInViewport(t)){var n,r=t.offset().left,s=a.children().width(),i=e(window).width();n=s<i?r-(i/2-s/2):r,e("#weeks-wrapper").parent().animate({scrollLeft:n},10)}}},_isElementInViewport:function(e){"function"==typeof jQuery&&e instanceof jQuery&&(e=e[0]);var t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)},dragMoveListener:function(e){var t=e.target,a=(parseFloat(t.getAttribute("data-x"))||0)+e.dx,n=(parseFloat(t.getAttribute("data-y"))||0)+e.dy;t.style.webkitTransform=t.style.transform="translate("+a+"px, "+n+"px)",t.setAttribute("data-x",a),t.setAttribute("data-y",n)},nextMonth:function(){currentYear=t([calendar.year,calendar.month,calendar.date]).add(1,"months").year(),currentMonth=t([calendar.year,calendar.month,calendar.date]).add(1,"months").month(),this._refreshViewOnDateChange()},previousMonth:function(){currentYear=t([calendar.year,calendar.month,calendar.date]).subtract(1,"months").year(),currentMonth=t([calendar.year,calendar.month,calendar.date]).subtract(1,"months").month(),this._refreshViewOnDateChange()},today:function(){calendar.year=t().year(),calendar.month=t().month(),calendar.date=t().format("D"),this._refreshViewOnDateChange()},_addEvent:function(e){Calendar.settings.events.push(e),this.gridLayout.reloadEvents()},_addEvents:function(e){Calendar.settings.events.concat(e);for(var t=0;t<e.length;t++)Calendar.settings.events.push(e[t]);this.gridLayout.reloadEvents()},_deleteEvent:function(e){if(Calendar.constructEventForUser(e).readOnly)return!1;Calendar.settings.events.splice(parseInt(e),1),this.gridLayout.reloadEvents()},_removeAllEvents:function(){Calendar.settings.events=[]},_updateEvent:function(e){if(Calendar.constructEventForUser(e.index).readOnly)return!1;Calendar.settings.events[e.index]=e,this.gridLayout.reloadEvents()},fitEventsToSlot:function(t){if(1==Calendar.settings.eventOverlap){var a=e(t).children().length,n=e(t).children();if(a>1)for(var r=n.width(),s=0;s<a;s++){e(n[s]).width(r/a),e(n[s+1]).css("left",r/2)}else n.width("100%"),e(n).css("left",0)}},_changeView:function(e){this.gridLayout.layout=e,this.gridLayout.rebuild()},_getView:function(){return Calendar.settings.view},timeSlotDblClick:function(e){r.settings.onTimeSlotDblClick(this.gridLayout.doubletap(e))},bindEventHanders:function(){interact(".cell-inner:not(.disable)").on("doubletap",function(t){Calendar.timeSlotDblClick(e(t.currentTarget)),t.preventDefault()}),interact(".event-container").on("tap",function(t){var a=Calendar.constructEventForUser(e(t.currentTarget).attr("data-index"));r.settings.onEventClick(a)})},constructEventForUser:function(e){return{index:e,title:Calendar.settings.events[e].title,class:Calendar.settings.events[e].class,start:Calendar.settings.events[e].start,end:Calendar.settings.events[e].end,allDay:Calendar.settings.events[e].allDay,other:Calendar.settings.events[e].other,readOnly:Calendar.settings.events[e].readOnly}},_setLocale:function(){t.locale(Calendar.settings.locale)},_refreshViewOnDateChange:function(){this._buildCurrentDateHeader(),this.yearPicker.render(),this.monthPicker.render(),this.gridLayout.refresh(),null!=this.gridLayout.miniCalendar&&this.gridLayout.miniCalendar.render()},_setDate:function(e){calendar.month=t(e).month(),calendar.year=t(e).year(),calendar.date=t(e).format("D"),calendar.dayOfWeek=t(e).day(),calendar.monthLong=t(e).format("MMM"),this._refreshViewOnDateChange()},_getDate:function(e){return null==e&&(e="MMMM Do YYYY"),t([calendar.year,calendar.month,calendar.date]).format(e)},_getEventArray:function(e){if(null==e||"all"==e)return Calendar.settings.events},_getDateRangeInView:function(){return this.gridLayout.getCurrentDateRange()},_scrollToFirstEvent:function(){this.gridLayout.scrollToFirstEvent()}},Calendar.Init(),this};a.prototype.rebuild=function(){Calendar.rebuild()},a.prototype.today=function(){Calendar.today()},a.prototype.next=function(){Calendar.nextMonth()},a.prototype.prev=function(){Calendar.previousMonth()},a.prototype.setDate=function(e){Calendar._setDate(e)},a.prototype.getDate=function(e){return Calendar._getDate(e)},a.prototype.destroy=function(){},a.prototype.setLocale=function(e){Calendar.settings.locale=e,Calendar._setLocale(),Calendar.rebuild()},a.prototype.reloadEvent=function(){Calendar.loadEvents()},a.prototype.addEvent=function(e){Calendar._addEvent(e)},a.prototype.addEvents=function(e){Calendar._addEvents(e)},a.prototype.removeEvent=function(e){Calendar._deleteEvent(e)},a.prototype.removeAllEvents=function(){Calendar._removeAllEvents()},a.prototype.updateEvent=function(e){Calendar._updateEvent(e)},a.prototype.getEvents=function(e){return Calendar._getEventArray(e)},a.prototype.view=function(e){return Calendar._changeView(e)},a.prototype.getView=function(){return Calendar._getView()},a.prototype.getDateRangeInView=function(){return Calendar._getDateRangeInView()},a.prototype.scrollToFirstEvent=function(){return Calendar._scrollToFirstEvent()},a.prototype.setState=function(e){switch(e){case"loading":Calendar._loading();break;case"loaded":Calendar._loaded()}},a.prototype.error=function(e){Calendar._errorMessage(e)};var n=e.fn.pagescalendar;e.fn.pagescalendar=function(t,n){var r=e(this),s=r.data("pagescalendar"),i="object"==typeof t&&t;return"string"==typeof t?s[t](n):this.each(function(){s||r.data("pagescalendar",s=new a(this,i))})},e.fn.pagescalendar.Constructor=a,e.fn.pagescalendar.defaults={ui:{year:{visible:!0,format:"YYYY",startYear:"2007",endYear:t().add(10,"year").format("YYYY"),eventBubble:!0},month:{visible:!0,format:"MMM",eventBubble:!0},dateHeader:{format:"MMMM YYYY, D dddd",visible:!0},week:{day:{format:"D"},header:{format:"dd"},eventBubble:!0,startOfTheWeek:"0",endOfTheWeek:"6",visible:!0},grid:{dateFormat:"D dddd",timeFormat:"h A",eventBubble:!0,scrollToFirstEvent:!1,scrollToAnimationSpeed:300,scrollToGap:20}},eventObj:{editable:!0},view:"week",now:null,locale:"en",timeFormat:"h:mm a",minTime:0,maxTime:24,dateFormat:"MMMM Do YYYY",slotDuration:"30",events:[],eventOverlap:!1,weekends:!0,disableDates:[],onViewRenderComplete:function(){},onEventDblClick:function(){},onEventClick:function(e){},onEventRender:function(){},onEventDragComplete:function(e){},onEventResizeComplete:function(e){},onTimeSlotDblClick:function(e){},onDateChange:function(e){}},e.fn.pagescalendar.noConflict=function(){return e.fn.pagescalendar=n,this}}),function(e,t){"function"==typeof define&&define.amd?define(["moment"],function(a){return e.DateRange=t(a)}):"object"==typeof exports?module.exports=t(require("moment")):e.DateRange=t(moment)}(this,function(e){var t={year:!0,month:!0,week:!0,day:!0,hour:!0,minute:!0,second:!0};function a(t,a){var n,r=t,s=a;1!==arguments.length&&void 0!==a||("object"==typeof t&&2===t.length?(r=t[0],s=t[1]):"string"==typeof t&&(r=(n=t.split("/"))[0],s=n[1])),this.start=e(null===r?-864e13:r),this.end=e(null===s?864e13:s)}return a.prototype.constructor=a,a.prototype.clone=function(){return e().range(this.start,this.end)},a.prototype.contains=function(e,t){var n=this.start,r=this.end;return e instanceof a?n<=e.start&&(r>e.end||r.isSame(e.end)&&!t):n<=e&&(r>e||r.isSame(e)&&!t)},a.prototype.overlaps=function(e){return null!==this.intersect(e)},a.prototype.intersect=function(e){var t=this.start,n=this.end;return t<=e.start&&e.start<n&&n<e.end?new a(e.start,n):e.start<t&&t<e.end&&e.end<=n?new a(t,e.end):e.start<t&&t<=n&&n<e.end?this:t<=e.start&&e.start<=e.end&&e.end<=n?e:null},a.prototype.add=function(t){return this.overlaps(t)?new a(e.min(this.start,t.start),e.max(this.end,t.end)):null},a.prototype.subtract=function(e){var t=this.start,n=this.end;return null===this.intersect(e)?[this]:e.start<=t&&t<n&&n<=e.end?[]:e.start<=t&&t<e.end&&e.end<n?[new a(e.end,n)]:t<e.start&&e.start<n&&n<=e.end?[new a(t,e.start)]:t<e.start&&e.start<e.end&&e.end<n?[new a(t,e.start),new a(e.end,n)]:t<e.start&&e.start<n&&e.end<n?[new a(t,e.start),new a(e.start,n)]:void 0},a.prototype.toArray=function(e,t){var a=[];return this.by(e,function(e){a.push(e)},t),a},a.prototype.by=function(t,a,n){return"string"==typeof t?function(t,a,n){var r=e(this.start);for(;this.contains(r,n);)a.call(this,r.clone()),r.add(1,t)}.call(this,t,a,n):function(t,a,n){var r=this/t,s=Math.floor(r);if(s===1/0)return;s===r&&n&&s--;for(var i=0;i<=s;i++)a.call(this,e(this.start.valueOf()+t.valueOf()*i))}.call(this,t,a,n),this},a.prototype.toString=function(){return this.start.format()+"/"+this.end.format()},a.prototype.valueOf=function(){return this.end-this.start},a.prototype.center=function(){var t=this.start+this.diff()/2;return e(t)},a.prototype.toDate=function(){return[this.start.toDate(),this.end.toDate()]},a.prototype.isSame=function(e){return this.start.isSame(e.start)&&this.end.isSame(e.end)},a.prototype.diff=function(e){return this.end.diff(this.start,e)},e.range=function(n,r){return n in t?new a(e(this).startOf(n),e(this).endOf(n)):new a(n,r)},e.range.constructor=a,e.fn.range=e.range,e.fn.within=function(e){return e.contains(this._d)},a});
